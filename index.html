<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Schpiel Generator API</title>
    <script>
        // This runs immediately to handle webhook requests
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // Check if this is an automated API call
            if (urlParams.get('auto') === 'true' && urlParams.get('client')) {
                const clientData = {
                    "Healthcare": ["504 Health Net", "Access Health", "Big Easy Medical", "Doctors Imaging", "MidCity TMS", "Southern ENT Associates", "Magnolia PT", "Medcentris", "St. Thomas Community Health Center"],
                    "Legal": ["Guarisco Cordes Lala", "Kruger& Hodges", "Law Office of Lance J. Robinson", "Kuchler Polk Weiner", "Valor Firm Client Square"],
                    "Financial": ["Crescent Bank", "First Bank", "Hibernia Bank", "Pelicoin", "OneMain", "Rent Reporters", "Tapcheck"],
                    "Education": ["Crescent City Schools", "Tulane I I H E", "University View Academy", "Louisiana School", "Valor Academy", "YCP"],
                    "Nonprofit": ["American Bird Conservancy", "Camp Restore", "EPNO", "Network Volunteers", "The Data Center"],
                    "Hospitality": ["Chateau Le Moyne", "Le Petit Theatre", "Red Horse Inn", "Lafitte Guest House", "Royal Heritage"],
                    "Real Estate": ["1201 Canal", "Four Winds", "Grand River", "Property One", "Wharf"],
                    "Food & Beverage": ["Cafe Beignet", "Dixie Beer", "Elysian Bar", "La Boca", "Miette", "Dragonfly Cafe"],
                    "Technology": ["Guardian Computer", "ID Scan", "Synergy", "Olive", "Trademark Media"],
                    "Retail": ["Acadian Windows", "Eisenhower Consignment", "Miette", "Bauhaus Salon"],
                    "Manufacturing": ["Armana Productions", "Craft Kettle", "Good Wood Nola", "Oracle Lighting", "Royal Coatings"],
                    "Construction": ["Bollinger Shipyards", "Gallo Mechanical", "Hummel Construction", "Landis Construction", "StrongBuilt Construction"],
                    "Wellness": ["Breathing Deeply", "Hair Loft", "Nerd Fitness"],
                    "Automotive": ["Superior Honda"],
                    "Media & Entertainment": ["Moxie Media", "The Swan Princess", "W W O Z"],
                    "Professional Services": ["Cardinal Expo", "DIY Pest Control", "GoodBee", "STM Bags", "York"],
                    "E-commerce": ["Passion Lillie", "Saint Hugh"],
                    "Tourism": ["Unique Nola"],
                    "Government": ["Downtown Development District", "JPFA", "NORPC", "Warren Montgomery, District Attorney"]
                };
                
                // Get parameters
                const client = urlParams.get('client') || 'Your Company';
                const industry = urlParams.get('industry') || '';
                const contact = urlParams.get('contact') || '';
                const referral = urlParams.get('referral') || '';
                const social = urlParams.get('social') || '';
                const strengths = urlParams.get('strengths') || '';
                const improvements = urlParams.get('improvements') || '';
                const notes = urlParams.get('notes') || '';
                const format = urlParams.get('format') || 'json';
                
                // Variation arrays for dynamic content
                const intros = [
                    "I'm Flynn, CEO of Online Optimism. I founded the agency in 2012 by myself. Since then, we've grown to a team of twenty full-time employees",
                    "Hi, I'm Flynn, founder and CEO of Online Optimism. What started as a solo venture in 2012 has evolved into a dynamic team of twenty professionals",
                    "I'm Flynn, and I lead Online Optimism. From humble beginnings in 2012, we've built a dedicated team of twenty digital marketing experts"
                ];
                
                const locations = [
                    "based around the East Coast and Gulf Coast",
                    "distributed across the Eastern seaboard and Gulf region",
                    "with team members from New Orleans to New York"
                ];
                
                const work = [
                    "working for thirty to forty clients at a time with their digital marketing & creative efforts",
                    "partnering with 30-40 businesses on their digital transformation journeys",
                    "managing comprehensive digital strategies for dozens of clients simultaneously"
                ];
                
                // Build schpiel with variations
                let schpiel = "[Introduction]\n";
                schpiel += intros[Math.floor(Math.random() * intros.length)] + ", ";
                schpiel += locations[Math.floor(Math.random() * locations.length)] + ", ";
                schpiel += work[Math.floor(Math.random() * work.length)] + ".\n\n";
                
                // Industry section
                if (industry && clientData[industry]) {
                    schpiel += `We have extensive experience in the ${industry} space, which gives us unique insights into your market.\n\n`;
                    const examples = clientData[industry].sort(() => 0.5 - Math.random()).slice(0, 2);
                    if (examples.length > 0) {
                        schpiel += `Some of our ${industry.toLowerCase()} clients include ${examples.join(' and ')}, giving us deep insights into what works in your market.\n\n`;
                    }
                } else {
                    schpiel += "We've worked with over 170 clients across diverse industries, bringing cross-sector insights that often lead to breakthrough strategies.\n\n";
                    // Pull random examples from different industries
                    const randomExamples = [
                        clientData['Healthcare']?.[Math.floor(Math.random() * clientData['Healthcare'].length)],
                        clientData['Financial']?.[Math.floor(Math.random() * clientData['Financial'].length)],
                        clientData['Hospitality']?.[Math.floor(Math.random() * clientData['Hospitality'].length)]
                    ].filter(Boolean);
                    if (randomExamples.length > 0) {
                        schpiel += `Our portfolio includes companies like ${randomExamples.join(', ')}, showcasing our versatility and expertise.\n\n`;
                    }
                }
                
                // Client focus section
                schpiel += `[Focus on ${client}]\n`;
                
                if (referral) {
                    schpiel += `Before this conversation, our team reviewed the notes from ${referral}, as well as your online presence, to make this meeting as efficient as possible since we know your time is valuable.\n\n`;
                } else {
                    schpiel += "Before this conversation, our team reviewed your online presence to make this meeting as efficient as possible since we know your time is valuable.\n\n";
                }
                
                // Social media analysis
                if (social) {
                    const platforms = social.split(',').map(p => p.trim());
                    schpiel += `We analyzed your presence across ${platforms.length} platforms including ${platforms.slice(0, 3).join(', ')}. `;
                    schpiel += "We've done a comprehensive analysis of your content strategy, engagement metrics, and competitive positioning.\n\n";
                } else {
                    schpiel += "We've conducted a thorough review of your digital footprint to understand your current market position.\n\n";
                }
                
                // Strengths section
                schpiel += "[Strengths & Observations]\n";
                if (strengths) {
                    schpiel += `You've clearly built something impressive with ${client}. ${strengths}.\n\n`;
                } else {
                    schpiel += `You've clearly built something impressive with ${client}. Your commitment to excellence is clear, and there's obvious potential for growth.\n\n`;
                }
                
                // Improvements section
                schpiel += "[Growth Opportunities]\n";
                if (improvements) {
                    schpiel += `We've identified several strategic opportunities where ${improvements}. `;
                    schpiel += "These are exactly the types of challenges Online Optimism excels at solving.\n\n";
                } else {
                    schpiel += "We've identified several strategic opportunities where Online Optimism's expertise could really make a difference. ";
                    schpiel += "Based on our initial review, there are several high-impact strategies we could implement quickly.\n\n";
                }
                
                // Additional notes
                if (notes) {
                    schpiel += `[Additional Context]\n${notes}\n\n`;
                }
                
                // Closing
                const closings = [
                    `All that to say, I want to make the most of our time together today. We can approach this conversation in two ways: I'm happy to answer any questions you have about Online Optimism and how we work, or I can dive into learning more about ${client} with some strategic questions I've prepared to determine if we're the right fit for each other. What would be most valuable for you?`,
                    `So here's where we are - I can tell you more about Online Optimism and our approach, or we can focus on ${client} and explore whether there's a good match between what you need and what we offer. Which direction feels right to you?`,
                    `Now, let's make this conversation work for you. Would you prefer to hear more about our agency and process, or should I jump into my questions about ${client} to see how we might be able to help? I'm ready either way.`
                ];
                
                schpiel += "[Next Steps]\n";
                schpiel += closings[Math.floor(Math.random() * closings.length)];
                
                // Output based on format
                if (format === 'json') {
                    const jsonResponse = {
                        success: true,
                        clientName: client,
                        contactName: contact,
                        industry: industry,
                        referralSource: referral,
                        socialPlatforms: social,
                        strengths: strengths,
                        improvements: improvements,
                        additionalNotes: notes,
                        schpielText: schpiel,
                        generatedAt: new Date().toISOString(),
                        version: "2.1"
                    };
                    
                    document.write(JSON.stringify(jsonResponse, null, 2));
                    document.close();
                } else if (format === 'text') {
                    document.write(schpiel);
                    document.close();
                } else {
                    // Default HTML output
                    document.write('<pre>' + schpiel + '</pre>');
                    document.close();
                }
            } else {
                // No parameters or not auto - show basic instructions
                document.write('<h1>Schpiel Generator API</h1>');
                document.write('<p>This endpoint requires parameters:</p>');
                document.write('<ul>');
                document.write('<li>client (required)</li>');
                document.write('<li>auto=true (required)</li>');
                document.write('<li>format=json (recommended)</li>');
                document.write('<li>industry, contact, referral, social, strengths, improvements, notes (optional)</li>');
                document.write('</ul>');
                document.write('<p>Example: ?client=TestCompany&industry=Healthcare&format=json&auto=true</p>');
                document.close();
            }
        })();
    </script>
</head>
<body>
    <p>Loading...</p>
</body>
</html>
